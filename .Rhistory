knitr::opts_chunk$set(echo = TRUE)
# Load team data
team.batting.2018 <- read.csv('data/team_data/2018batting.csv')
team.pitching.2018 <- read.csv('data/team_data/2018pitching.csv')
team.batting.2019 <- read.csv('data/team_data/2019batting.csv')
team.pitching.2019 <- read.csv('data/team_data/2019pitching.csv')
team.batting.2020 <- read.csv('data/team_data/2020batting.csv')
team.pitching.2020 <- read.csv('data/team_data/2020pitching.csv')
team.batting.2021 <- read.csv('data/team_data/2021batting.csv')
team.pitching.2021 <- read.csv('data/team_data/2021pitching.csv')
team.batting.2022 <- read.csv('data/team_data/2022batting.csv')
team.pitching.2022 <- read.csv('data/team_data/2022pitching.csv')
# Load player data
player.batting.2015 <- read.csv('data/player_data/batting2015.csv')
player.pitching.2015 <- read.csv('data/player_data/pitching2015.csv')
player.batting.2016 <- read.csv('data/player_data/batting2016.csv')
player.pitching.2016 <- read.csv('data/player_data/pitching2016.csv')
player.batting.2017 <- read.csv('data/player_data/batting2017.csv')
player.pitching.2017 <- read.csv('data/player_data/pitching2017.csv')
player.batting.2018 <- read.csv('data/player_data/batting2018.csv')
player.pitching.2018 <- read.csv('data/player_data/pitching2018.csv')
player.batting.2019 <- read.csv('data/player_data/batting2019.csv')
player.pitching.2019 <- read.csv('data/player_data/pitching2019.csv')
player.batting.2020 <- read.csv('data/player_data/batting2020.csv')
player.pitching.2020 <- read.csv('data/player_data/pitching2020.csv')
player.batting.2021 <- read.csv('data/player_data/batting2021.csv')
player.pitching.2021 <- read.csv('data/player_data/pitching2021.csv')
player.batting.2022 <- read.csv('data/player_data/batting2022.csv')
player.pitching.2022 <- read.csv('data/player_data/pitching2022.csv')
# data cleaning
team2018 <- merge(team.pitching.2018, team.batting.2018,by="Tm")
team2019 <- merge(team.pitching.2019, team.batting.2019,by="Tm")
team2020 <- merge(team.pitching.2020, team.batting.2020,by="Tm")
team2021 <- merge(team.pitching.2021, team.batting.2021,by="Tm")
team2022 <- merge(team.pitching.2022, team.batting.2022,by="Tm")
# split into test and train, and create total for EDA
team.list <- rbind(team2018, team2019, team2020, team2021)
team.train <- subset(team.list, team.list$Tm != '' & team.list$Tm != 'League Average')
drop <- c("W","L") # drop wins and losses columns
team.train <- team.train[,!(names(team.train) %in% drop)]
rownames(team.train) <- 1:nrow(team.train)
team.test <- subset(team2022, team2022$Tm != '' & team2022$Tm != 'League Average')
team.test <- team.test[,!(names(team.test) %in% drop)]
rownames(team.test) <- 1:nrow(team.test)
combined <- rbind(team.train, team.test)
rownames(combined) <- 1:nrow(combined)
# factor teams
team.train$Tm <- factor(team.train$Tm)
team.test$Tm <- factor(team.test$Tm)
combined$Tm <- factor(combined$Tm)
library(dplyr)
player2015 <- merge(player.pitching.2015, player.pitching.2015,by="Tm")
player2016 <- merge(player.pitching.2016, player.pitching.2016,by="Tm")
player2017 <- merge(player.pitching.2017, player.pitching.2017,by="Tm")
player2018 <- merge(player.pitching.2018, player.pitching.2018,by="Tm")
player2019 <- merge(player.pitching.2019, player.pitching.2019,by="Tm")
player2020 <- merge(player.pitching.2020, player.pitching.2020,by="Tm")
player2021 <- merge(player.pitching.2021, player.pitching.2021,by="Tm")
player2022 <- merge(player.pitching.2022, player.pitching.2022,by="Tm") # test
# 2015
player2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop')
# put all data frames into list
#avg_player_age <- list(player2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#                       player2016 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#                       player2017 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#                       player2018 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#                       player2019 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#                       player2020 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#                       player2021 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'))
# merge all data frames in list
#Reduce(function(x, y) merge(x, y, all=TRUE), avg_player_age)
#avg_player_age %>% reduce(full_join, by='Tm')
#merge(player2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),
#      player2016 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop'),)
#View(Reduce(function(x, y) merge(x, y, all=TRUE), avg_player_age))
library(dplyr)
player2015 <- merge(player.pitching.2015, player.pitching.2015,by="Tm")
player2015$year <- 2015
player2016 <- merge(player.pitching.2016, player.pitching.2016,by="Tm")
player2016$year <- 2016
player2017 <- merge(player.pitching.2017, player.pitching.2017,by="Tm")
player2017$year <- 2017
player2018 <- merge(player.pitching.2018, player.pitching.2018,by="Tm")
player2018$year <- 2018
player2019 <- merge(player.pitching.2019, player.pitching.2019,by="Tm")
player2019$year <- 2019
player2020 <- merge(player.pitching.2020, player.pitching.2020,by="Tm")
player2020$year <- 2020
player2021 <- merge(player.pitching.2021, player.pitching.2021,by="Tm")
player2021$year <- 2021
player2022 <- merge(player.pitching.2022, player.pitching.2022,by="Tm") # test
player2022$year <- 2022
player2015
head(player2015)
player2015 <- rbind(player.batting.2015, player.pitching.2015,by="Tm")
player.pitching.2015$year <- 2015
player.batting.2015$year <- 2015
player.pitching.2016$year <- 2016
player.batting.2016$year <- 2016
player.pitching.2017$year <- 2017
player.batting.2017$year <- 2017
player.pitching.2018$year <- 2018
player.batting.2018$year <- 2018
player.pitching.2019$year <- 2019
player.batting.2019$year <- 2019
player.pitching.2020$year <- 2020
player.batting.2020$year <- 2020
player.pitching.2021$year <- 2021
player.batting.2021$year <- 2021
player.pitching.2022$year <- 2022
player.batting.2022$year <- 2022
summary(player.batting.2015.year)
summary(player.batting.2015$year)
summary(player.batting.2015)
# 2015
player2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop')
# 2015
player.batting.2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age.x),.groups = 'drop')
# 2015
player.batting.2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age),.groups = 'drop')
player.batting.2015
head(player.batting.2015)
?groupby
?group_by
group_by(player.batting.2015, Tm)
head(player.batting.2015)
summarise(group_by(player.batting.2015, Tm), avg_age = mean(Age))
summarise(group_by(player.batting.2015, Tm), avg_age = mean(Age), groups="drop")
summarise(group_by(player.batting.2015, Tm), avg_age = mean(Age), .groups="drop")
summary(player.batting.2015)
# 2015
player.batting.2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age),.groups = 'drop')
# 2015
test <- player.batting.2015 %>% group_by(Tm) %>% summarise(avg_age = mean(Age),.groups = 'drop')
test
# Load player data
player_data <- list()
for (year in 2015:2022) {
player_data[[year]] <- list()
for (bp in c("batting", "pitching")) {
player_data[[year]][[bp]] <- read.csv(paste("data/player_data/", bp, year, ".csv", sep=""))
}
}
# Load player data
years <- 2015:2022
player_data <- list()
for (year in years) {
player_data[[year]] <- list()
for (bp in c("batting", "pitching")) {
player_data[[year]][[bp]] <- read.csv(paste("data/player_data/", bp, year, ".csv", sep=""))
}
}
years <- 2015:2022
bps <- c("batting, pitching")
player_data <- list()
for (year in years) {
player_data[[year]] <- list()
for (bp in bps) {
player_data[[year]][[bp]] <- read.csv(paste("data/player_data/", bp, year, ".csv", sep=""))
}
}
bps
# Load player data
years <- 2015:2022
bps <- c("batting", "pitching")
player_data <- list()
for (year in years) {
player_data[[year]] <- list()
for (bp in bps) {
player_data[[year]][[bp]] <- read.csv(paste("data/player_data/", bp, year, ".csv", sep=""))
}
}
# Sus
# player2015 <- merge(player.pitching.2015, player.pitching.2015,by="Tm")
# player2016 <- merge(player.pitching.2016, player.pitching.2016,by="Tm")
# player2017 <- merge(player.pitching.2017, player.pitching.2017,by="Tm")
# player2018 <- merge(player.pitching.2018, player.pitching.2018,by="Tm")
# player2019 <- merge(player.pitching.2019, player.pitching.2019,by="Tm")
# player2020 <- merge(player.pitching.2020, player.pitching.2020,by="Tm")
# player2021 <- merge(player.pitching.2021, player.pitching.2021,by="Tm")
# player2022 <- merge(player.pitching.2022, player.pitching.2022,by="Tm") # test
# /Sus
for (year in years) {
for (bp in bps) {
player_data[[year]][[bp]] <- year
}
}
summary(player.batting.2015)
unlist(lapply(player_data[[2015]][["batting"]], is.numeric), use.names = FALSE)
unlist(lapply(x, is.numeric), use.names = FALSE)
select_if(player_data[[year]][[bp]], is.numeric)
player_data[[year]][[bp]]
# Load player data
years <- 2015:2022
bps <- c("batting", "pitching")
player_data <- list()
for (year in years) {
player_data[[year]] <- list()
for (bp in bps) {
player_data[[year]][[bp]] <- read.csv(paste("data/player_data/", bp, year, ".csv", sep=""))
}
}
# Sus
# player2015 <- merge(player.pitching.2015, player.pitching.2015,by="Tm")
# player2016 <- merge(player.pitching.2016, player.pitching.2016,by="Tm")
# player2017 <- merge(player.pitching.2017, player.pitching.2017,by="Tm")
# player2018 <- merge(player.pitching.2018, player.pitching.2018,by="Tm")
# player2019 <- merge(player.pitching.2019, player.pitching.2019,by="Tm")
# player2020 <- merge(player.pitching.2020, player.pitching.2020,by="Tm")
# player2021 <- merge(player.pitching.2021, player.pitching.2021,by="Tm")
# player2022 <- merge(player.pitching.2022, player.pitching.2022,by="Tm") # test
# /Sus
for (year in years) {
for (bp in bps) {
player_data[[year]][[bp]]$year <- year
}
}
select_if(player_dat[[year]][[bp]], is.numeric)
select_if(player_data[[year]][[bp]], is.numeric)
names(select_if(player_data[[year]][[bp]], is.numeric))
player.batting.2015 %>% group_by(Tm) %>% summarise(across(everything(), mean))
player.batting.2015 %>% group_by(Tm) %>% summarise_all("mean")
agg_data <- list()
for (year in years) {
agg_data[[year]] <- list()
for (bp in bps) {
quant_cols <- names(select_if(player_data[[year]][[bp]], is.numeric))
agg_data[[year]][[bp]] <- player_data[[year]][[bp]] %>% group_by(Tm) %>% summarise_all("mean")
}
}
agg_data <- list()
for (year in years) {
agg_data[[year]] <- list()
for (bp in bps) {
quant_cols <- names(select_if(player_data[[year]][[bp]], is.numeric))
agg_data[[year]][[bp]] <- player_data[[year]][[bp]][, quant_cols] %>% group_by(Tm) %>% summarise_all("mean")
}
}
agg_data <- list()
for (year in years) {
agg_data[[year]] <- list()
for (bp in bps) {
quant_cols <- names(select_if(player_data[[year]][[bp]], is.numeric))
agg_data[[year]][[bp]] <- player_data[[year]][[bp]][, c("Tm", quant_cols)] %>% group_by(Tm) %>% summarise_all("mean")
}
}
agg_data[[2015]][["batting"]]
player_data[[year]][[bp]]
player_data[[year]][["batting"]]
player_data[[2015]][["batting"]]
test <- player_data[[2015]][["batting"]]
test[test$PA > 0,]
test[test$PA > 0,]$BA
test[test$PA > 0,]
agg_data[[2015]][["batting"]]
team2018
team_data <- list()
team_data[[2018]] <- team2018
team_data[[2019]] <- team2019
team_data[[2020]] <- team2020
team_data[[2021]] <- team2021
team_data[[2022]] <- team2022
team_wins <- list()
for (year in 2018:2022) {
team_wins[[year]] <- team_data[[year]]$W.L
}
team_wins[[2018]]
team_wins <- list()
for (year in 2018:2022) {
team_wins[[year]] <- team_data[[year]][,"W.L"]
}
team_wins <- list()
for (year in 2018:2022) {
team_wins[[year]] <- team_data[[year]][,"W.L."]
}
team_wins[[2015]]
team_wins[[2018]]
names(team_wins[[2018]])
team_data[[2018]]
team_data[[2018]]$Tm
team_data[[2018]]$Tm[2:31]
team_data[[2018]]$Tm[2:32]
team_data[[2018]]$Tm[2:33]
player_data[[2018]][["batting"]]
unique(player_data[[2018]][["batting"]]$Tm)
sort(unique(player_data[[2018]][["batting"]]$Tm))
unique(team_data[[2018]]$Tm)
team_wins <- list()
for (year in 2018:2022) {
team_wins[[year]] <- team_data[[year]][-c("", "League Average"),"W.L."]
}
head(team_data[[2018]])
team_wins <- list()
for (year in 2018:2022) {
team_wins[[year]] <- team_data[[year]][!(team_data[[year]]$Tm %in% c("", "League Average")),"W.L."]
}
team_wins[[2018]]
team_data[[year]][!(team_data[[year]]$Tm %in% c("", "League Average")),]
team_data[[year]][!(team_data[[year]]$Tm %in% c("", "League Average")),]$Tm
sort(unique(player_data[[2018]][["batting"]]$Tm))
paste(sort(unique(player_data[[2018]][["batting"]]$Tm)), sep=", ")
paste(*sort(unique(player_data[[2018]][["batting"]]$Tm)), sep=", ")
paste(sort(unique(player_data[[2018]][["batting"]]$Tm)), collapse=", ")
paste(sort(unique(player_data[[2018]][["batting"]]$Tm)), collapse="\", \"")
paste(sort(unique(player_data[[2018]][["batting"]]$Tm)), collapse="", "")
paste(sort(unique(player_data[[2018]][["batting"]]$Tm)), collapse='", "')
print(paste(sort(unique(player_data[[2018]][["batting"]]$Tm)), collapse='", "'))
library(plyr)
teamdata[[2018]]$Tm
team_data[[2018]]$Tm
team_data[[2018]]$Tm
agg_data[[2018]]["batting"]
agg_data[[2018]][["batting"]]
long_team_names <- team_data[[year]][!(team_data[[year]]$Tm %in% c("", "League Average")),]$Tm
short_team_names <- c("ARI", "ATL", "BAL", "BOS", "CHC", "CHW", "CIN", "CLE", "COL", "DET",
"HOU", "KCR", "LAA", "LAD", "MIA", "MIL", "MIN", "NYM", "NYY", "OAK",
"PHI", "PIT", "SDP", "SFG", "SEA", "STL", "TBR", "TEX", "TOR", "WSN")
agg_data <- list()
for (year in years) {
agg_data[[year]] <- list()
for (bp in bps) {
quant_cols <- names(select_if(player_data[[year]][[bp]], is.numeric))
agg_data[[year]][[bp]] <- player_data[[year]][[bp]][, c("Tm", quant_cols)] %>% group_by(Tm) %>% summarise_all("mean")
agg_data[[year]][[bp]]$long_Tm <- mapvalues(agg_data[[year]][[bp]]$Tm,
from=short_team_names,
to=long_team_names)
}
}
agg_data[[2018]][["batting"]]
agg_data[[2018]][["batting"]]$long_Tm
long_team_names
agg_data <- list()
for (year in years) {
agg_data[[year]] <- list()
for (bp in bps) {
quant_cols <- names(select_if(player_data[[year]][[bp]], is.numeric))
agg_data[[year]][[bp]] <- player_data[[year]][[bp]][, c("Tm", quant_cols)] %>% group_by(Tm) %>% summarise_all("mean")
agg_data[[year]][[bp]]$long_Tm <- mapvalues(agg_data[[year]][[bp]]$Tm,
from=short_team_names,
to=long_team_names)
agg_data[[year]][[bp]] <- agg_data[[year]][[bp]][!(agg_data[[year]][[bp]]$Tm == "TOT"),]
}
}
agg_year[[2018]][["Batting"]]
agg_year[[2018]][["batting"]]
agg_datta[[2018]][["batting"]]
agg_data[[2018]][["batting"]]$Tm
agg_data[[2018]][["batting"]]$long_Tm
indiv_total <- list()
for (year in years) {
player_combo[[year]] <- merge(player_data[[year]][[bps[0]]], player_data[[year]][[bps[1]]])
}
player_combo <- list()
for (year in years) {
player_combo[[year]] <- merge(player_data[[year]][[bps[0]]], player_data[[year]][[bps[1]]])
}
player_data[[year]][[bps[0]]]
bps[0]
player_combo <- list()
for (year in years) {
player_combo[[year]] <- merge(player_data[[year]][[bps[1]]], player_data[[year]][[bps[2]]])
}
player_combo[[2018]]
player_combo <- list()
for (year in years) {
player_combo[[year]] <- merge(player_data[[year]][[bps[1]]], player_data[[year]][[bps[2]]], by="Tm")
}
player_combo[[2018]]
player_combo <- list()
for (year in years) {
player_combo[[year]] <- merge(agg_data[[year]][[bps[1]]], agg_data[[year]][[bps[2]]], by="Tm")
}
player_combo[[2018]]
team_wins <- list()
for (year in 2018:2022) {
team_wins[[year]] <- team_data[[year]][!(team_data[[year]]$Tm %in% c("", "League Average")),c("Tm", "W.L.")]
}
player_with_wins <- list()
player_with_wins <- list()
for (year in 2018:2021) {
player_with_wins[[year]] <- merge(player_combo[[year]], team_wins[[year+1]], by.x="long_Tm", by.y="Tm")
}
player_combo[[2018]]
names(player_combo[[2018]])
player_combo[[2018]]$Tm
player_combo[[2018]]$long_Tm
player_combo[[2018]]$long_Tm.x
player_with_wins <- list()
for (year in 2018:2021) {
player_with_wins[[year]] <- merge(player_combo[[year]], team_wins[[year+1]], by.x="long_Tm.x", by.y="Tm")
}
player_with_wins
player_with_wins[[2018]]
summary(player_data[[2018]][["batting"]])
